version: '2'

services:
  api:
    build: ./infrastructure/nginx
    image: skytsar/nginx
    ports:
    - "80:80"
    volumes:
    - ./app/api:/usr/share/nginx/html
    depends_on:
    - phpfpm
    command: /bin/bash -c "envsubst '\$${NGINX_SERVER_NAME} \$${NGINX_FASTCGI_READ_TIMEOUT}' < /etc/nginx/nginx.conf.template > /etc/nginx/nginx.conf && nginx -g 'daemon off;'"
  phpfpm:
    build: ./infrastructure/php-fpm
    image: skytsar/phpfpm-phalcon
    volumes:
    - ./app/api:/var/www/html
  postgres:
    build: ./infrastructure/postgres
    image: skytsar/postgres
    hostname: postgres
    expose:
      - 5432
    environment:
      - POSTGRES_USER
      - POSTGRES_PASSWORD
